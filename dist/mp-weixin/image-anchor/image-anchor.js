"use strict";function t(o){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(o)}function o(t,o){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);o&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),e.push.apply(e,i)}return e}function e(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(o){i(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function i(t,o,e){return(o=n(o))in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}function n(o){var e=r(o,"string");return"symbol"==t(e)?e:e+""}function r(o,e){if("object"!=t(o)||!o)return o;var i=o[Symbol.toPrimitive];if(void 0!==i){var n=i.call(o,e||"default");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(o)}Component({options:{addGlobalClass:!0},properties:{node:{type:Object,value:{}},opts:{type:Array,value:[]}},data:{imageLoaded:!1,imageWidth:0,imageHeight:0,anchors:[],styles:[],mode:"container",animation:!0,activeAnchor:null,tooltipPosition:"bottom",anchorY:50,anchorSizePercent:8,tooltipOffset:4,tooltipVisible:!1,tooltipClosing:!1,showModal:!1,modalClosing:!1,showMask:!1,isPc:!1},lifetimes:{attached:function(){this.checkIsPc(),this.initFromRoot()}},methods:{checkIsPc:function(){try{var t=wx.getSystemInfoSync(),o=t.screenWidth>=768;this.setData({isPc:o})}catch(t){console.error("获取系统信息失败",t)}},initFromRoot:function(){var t=this.data.node,o=[],e=[],i="container",n=!0;t.anchorData&&(o=t.anchorData.anchors||[],e=t.anchorData.styles||[],i=t.anchorData.tooltipMode||"container",n=!1!==t.anchorData.showAnimation),this.setData({anchors:o,styles:e,mode:i,animation:n})},onImageLoad:function(t){var o=this,e=t.detail;e.width,e.height;this.createSelectorQuery().select(".anchor-image").boundingClientRect(function(t){t&&o.setData({imageLoaded:!0,imageWidth:t.width,imageHeight:t.height})}).exec(),this.triggerEvent("imgload",t.detail)},onImageError:function(t){this.triggerEvent("imgerror",t.detail)},onImageTap:function(t){if(!(t.target&&t.target.dataset&&t.target.dataset.anchor)){var o=this.data.node;this.triggerEvent("imgtap",o.attrs)}},onAnchorTap:function(t){var o,e=this,i=t.detail||{},n=i.anchor;if(n){this.setData({activeAnchor:null,tooltipVisible:!1});var r=this.data.mode,a=n.position||{x:50,y:50},s=a.y>=50?"top":"bottom",c=a.y,l=(null===(o=n.style)||void 0===o?void 0:o.size)||8,h=this.data,p=h.imageWidth,u=h.imageHeight,g=l/2;if(p&&u){g=l*(p/u)/2}this.setData({activeAnchor:n,tooltipPosition:s,anchorY:c,anchorSizePercent:l,tooltipOffset:g,tooltipClosing:!1,showModal:"modal"===r,showMask:"container"===r}),"container"===r&&setTimeout(function(){e.setData({tooltipVisible:!0})},20),this.triggerEvent("anchortap",{anchor:n}),this.triggerEvent("tooltipshow",{anchor:n})}},onTooltipClose:function(){var t=this,o=this.data,e=o.activeAnchor;"container"===o.mode?(this.setData({tooltipClosing:!0}),setTimeout(function(){t.setData({activeAnchor:null,tooltipVisible:!1,tooltipClosing:!1,showMask:!1}),t.triggerEvent("tooltiphide",{anchor:e})},300)):(this.setData({modalClosing:!0}),setTimeout(function(){t.setData({activeAnchor:null,showModal:!1,modalClosing:!1,showMask:!1,tooltipVisible:!1}),t.triggerEvent("tooltiphide",{anchor:e})},300))},onPageChange:function(t){this.triggerEvent("pagechange",e(e({},t.detail),{},{anchor:this.data.activeAnchor}))},onMaskTap:function(){this.onTooltipClose()},onContainerMaskTap:function(){this.onTooltipClose()},onTooltipImgTap:function(t){var o=t.detail||{},e=o.src;if(e){var i=this.getRoot();if(!i)return void wx.previewImage({urls:[e],current:e});if(i.triggerEvent("imgtap",{src:e}),i.data.previewImg){var n=i.imgList||[e];wx.previewImage({showmenu:i.data.showImgMenu,current:e,urls:n.includes(e)?n:[e]})}}},getRoot:function(){for(var t=this.selectOwnerComponent();t;){if(void 0!==t.imgList)return t;t=t.selectOwnerComponent?t.selectOwnerComponent():null}return null},stopPropagation:function(){}}});