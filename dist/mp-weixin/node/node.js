"use strict";function t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)}return r}function e(e){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?t(Object(i),!0).forEach(function(t){r(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function r(t,e,r){return(e=o(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t){var e=i(t,"string");return"symbol"==n(e)?e:e+""}function i(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=s(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,n=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw n}}}}function s(t,e){if(t){if("string"==typeof t)return c(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=Array(e);r<e;r++)o[r]=t[r];return o}Component({data:{ctrl:{},nodes:[],isiOS:wx.getDeviceInfo().system.includes("iOS")},properties:{childs:{type:Array,value:[],observer:function(t){function e(t,o,i){for(var s=t.length;s>o.length;)0!==Object.keys(t[s-1]).length&&(r[i+"["+(s-1)+"]"]={}),s-=1;for(;s<o.length;)r[i+"["+s+"]"]=o[s],s+=1;for(var c=0;c<Math.min(t.length,o.length);c++){var u,l=a(Object.keys(t[c]).concat(Object.keys(o[c])));try{for(l.s();!(u=l.n()).done;){var f=u.value;if(Array.isArray(o[c][f]))Array.isArray(t[c][f])?e(t[c][f],o[c][f],i+"["+c+"]."+f):r[i+"["+c+"]."+f]=o[c][f];else if("object"!==n(o[c][f]))t[c][f]!==o[c][f]&&(r[i+"["+c+"]"]=o[c]);else if(void 0===t[c][f]||void 0===o[c][f])r[i+"["+c+"]."+f]=o[c][f];else{var h,d=a(Object.keys(t[c][f]).concat(Object.keys(o[c][f])));try{for(d.s();!(h=d.n()).done;){var p=h.value;t[c][f][p]!==o[c][f][p]&&(r[i+"["+c+"]."+f+"."+p]=o[c][f][p])}}catch(t){d.e(t)}finally{d.f()}}}}catch(t){l.e(t)}finally{l.f()}}}var r={};e(this.data.nodes,t,"nodes"),this.setData(r)}},opts:Array},options:{addGlobalClass:!0},attached:function(){this.triggerEvent("add",this,{bubbles:!0,composed:!0})},methods:{noop:function(){},getNode:function(t){try{for(var e=t.split("_"),r=this.data.childs[e[0]],o=1;o<e.length;o++)r=r.children[e[o]];return r}catch(t){return{text:"",attrs:{},children:[]}}},play:function(t){var r=t.target.dataset.i,o=this.getNode(r);if(this.root.triggerEvent("play",{source:o.name,attrs:e(e({},o.attrs),{},{src:o.src[this.data.ctrl[r]||0]})}),this.root.data.pauseVideo){for(var i=!1,n=t.target.id,a=this.root._videos.length;a--;)this.root._videos[a].id===n?i=!0:this.root._videos[a].pause();if(!i){var s=wx.createVideoContext(n,this);s.id=n,this.root.playbackRate&&s.playbackRate(this.root.playbackRate),this.root._videos.push(s)}}},imgTap:function(t){var e=this.getNode(t.target.dataset.i);if(e.a)return this.linkTap(e.a);if(!e.attrs.ignore&&(this.root.triggerEvent("imgtap",e.attrs),this.root.data.previewImg)){var r=this.root.imgList[e.i];wx.previewImage({showmenu:this.root.data.showImgMenu,current:r,urls:this.root.imgList})}},imgLoad:function(t){var e,o=t.target.dataset.i,i=this.getNode(o);i.w?(this.data.opts[1]&&!this.data.ctrl[o]||-1===this.data.ctrl[o])&&(e=1):e=t.detail.width,e&&this.setData(r({},"ctrl."+o,e)),this.checkReady()},checkReady:function(){var t=this;this.root.data.lazyLoad||(this.root.imgList._unloadimgs-=1,this.root.imgList._unloadimgs||setTimeout(function(){t.root.getRect().then(function(e){t.root.triggerEvent("ready",e)}).catch(function(){t.root.triggerEvent("ready",{})})},350))},linkTap:function(t){var e=t.currentTarget?this.getNode(t.currentTarget.dataset.i):{},r=e.attrs||t,o=r.href;this.root.triggerEvent("linktap",Object.assign({innerText:this.root.getText(e.children||[])},r)),o&&("#"===o[0]?this.root.navigateTo(o.substring(1)).catch(function(){}):o.split("?")[0].includes("://")?this.root.data.copyLink&&wx.setClipboardData({data:o,success:function(){return wx.showToast({title:"链接已复制"})}}):wx.navigateTo({url:o,fail:function(){wx.switchTab({url:o,fail:function(){}})}}))},mediaError:function(t){var e=t.target.dataset.i,o=this.getNode(e);if("video"===o.name||"audio"===o.name){var i=(this.data.ctrl[e]||0)+1;if(i>o.src.length&&(i=0),i<o.src.length)return this.setData(r({},"ctrl."+e,i))}else"img"===o.name&&(this.data.opts[2]&&this.setData(r({},"ctrl."+e,-1)),this.checkReady());this.root&&this.root.triggerEvent("error",{source:o.name,attrs:o.attrs,errMsg:t.detail.errMsg})}}});