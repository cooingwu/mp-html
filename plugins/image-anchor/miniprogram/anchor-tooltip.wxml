<!-- 解读弹窗组件模板
  支持富文本、视频、音频三种内容类型
  样式与管理端和 anchor-image 组件保持一致 -->
<wxs module="utils" src="./utils.wxs"></wxs>
<view class="tooltip-container {{mode === 'modal' ? 'modal' : ''}} position-{{position}}" catchtap="stopPropagation">
  <!-- 关闭按钮 -->
  <view class="close-btn" bindtap="onClose">×</view>
  <!-- 内容区域 -->
  <view class="tooltip-content">
    <view class="page-content" wx:if="{{currentPage}}">
      <!-- 富文本类型 -->
      <block wx:if="{{currentPage.type === 'richtext'}}">
        <view wx:if="{{currentPage.title}}" class="page-title">{{currentPage.title}}</view>
        <view class="richtext-body {{currentPage.image ? 'has-image' : ''}}">
          <scroll-view scroll-y class="page-text-scroll" wx:if="{{currentPage.content}}" catchtouchmove="stopPropagation">
            <view class="page-text">{{currentPage.content}}</view>
          </scroll-view>
          <image wx:if="{{currentPage.image}}" class="page-image" src="{{currentPage.image}}" mode="aspectFit" data-src="{{currentPage.image}}" bindtap="onImageTap" />
        </view>
      </block>
      <!-- 视频类型 -->
      <block wx:elif="{{currentPage.type === 'video'}}">
        <video wx:if="{{currentPage.video}}" class="page-video" src="{{currentPage.video}}" poster="{{currentPage.videoCover}}" controls="{{true}}" show-center-play-btn="{{true}}" object-fit="contain" bindplay="onVideoPlay" />
      </block>
      <!-- 音频类型 -->
      <block wx:elif="{{currentPage.type === 'audio'}}">
        <view class="audio-container">
          <image wx:if="{{currentPage.audioCover}}" class="audio-cover" src="{{currentPage.audioCover}}" mode="aspectFill" />
          <view wx:else class="audio-cover-placeholder">
            <text class="audio-icon">♫</text>
          </view>
          <view class="audio-info">
            <view class="audio-title">{{currentPage.audioTitle || '音频'}}</view>
            <view class="audio-controls">
              <view class="play-btn" bindtap="toggleAudio">
                <text class="play-icon">{{isPlaying ? '⏸' : '▶'}}</text>
              </view>
              <view class="audio-progress">
                <view class="progress-bar">
                  <view class="progress-fill" style="width: {{audioDuration > 0 ? (audioCurrentTime / audioDuration * 100) : 0}}%"></view>
                </view>
                <view class="time-display">
                  <text>{{utils.formatTime(audioCurrentTime)}}</text>
                  <text>/</text>
                  <text>{{utils.formatTime(audioDuration)}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
    </view>
    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <text>暂无内容</text>
    </view>
  </view>
  <!-- 分页控制（多页时显示） -->
  <view wx:if="{{pages.length > 1}}" class="pagination">
    <view class="page-btn page-prev {{currentIndex === 0 ? 'disabled' : ''}}" bindtap="prevPage">
      <text class="btn-icon">‹</text>
    </view>
    <view class="page-dots">
      <view wx:for="{{pages}}" wx:key="id" class="dot {{index === currentIndex ? 'active' : ''}}" bindtap="goToPage" data-index="{{index}}"></view>
    </view>
    <view class="page-btn page-next {{currentIndex === pages.length - 1 ? 'disabled' : ''}}" bindtap="nextPage">
      <text class="btn-icon">›</text>
    </view>
  </view>
</view>
