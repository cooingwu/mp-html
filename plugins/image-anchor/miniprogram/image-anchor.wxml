<!--
  图片锚点容器组件
  用于包装带有锚点的图片
-->
<view class="image-anchor-container">
  <!-- 图片 -->
  <image
    class="anchor-image _img"
    id="{{node.attrs.id}}"
    src="{{node.attrs.src}}"
    mode="{{!node.h ? 'widthFix' : (!node.w ? 'heightFix' : (node.m || 'scaleToFill'))}}"
    lazy-load="{{opts[0]}}"
    show-menu-by-longpress="{{opts[3] && !node.attrs.ignore}}"
    style="{{node.attrs.style}}"
    bindload="onImageLoad"
    binderror="onImageError"
    bindtap="onImageTap"
  />

  <!-- 锚点层 -->
  <view class="anchors-layer" wx:if="{{imageLoaded && anchors.length > 0}}">
    <anchor-point
      wx:for="{{anchors}}"
      wx:key="id"
      anchor="{{item}}"
      styles="{{styles}}"
      animation="{{animation}}"
      image-width="{{imageWidth}}"
      bindanchortap="onAnchorTap"
    />
  </view>

  <!-- 容器内弹窗 -->
  <anchor-tooltip
    wx:if="{{mode === 'container' && activeAnchor}}"
    anchor="{{activeAnchor}}"
    position="{{tooltipPosition}}"
    mode="container"
    bindclose="onTooltipClose"
    bindpagechange="onPageChange"
  />
</view>

<!-- Modal 弹窗（fixed 定位，覆盖全屏） -->
<view class="modal-overlay" wx:if="{{showModal}}" catchtap="onMaskTap">
  <view class="modal-mask"></view>
  <view class="modal-content" catchtap="stopPropagation">
    <anchor-tooltip
      anchor="{{activeAnchor}}"
      mode="modal"
      bindclose="onTooltipClose"
      bindpagechange="onPageChange"
    />
  </view>
</view>
